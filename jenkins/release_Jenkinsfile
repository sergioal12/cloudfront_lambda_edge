#!/usr/bin/env groovy
@Library('utils@master') _
import com.lmig.intl.cloud.jenkins.util.EnvConfigUtil
def ARTIFACT_VERSION = "1.${BUILD_NUMBER}";
node('linux') {
     stage('Preparation') {
      git credentialsId: 'intl_gituser', url: 'https://intl_gituser@bitbucket-latam.aws.lmig.com/scm/anpolserv/co-plsv-front-infr.git', branch: 'master'
      sh 'pwd'
      sh 'ls'
   }
   stage('Zip Files && Artifactory upload') {
			//zip dir: '', glob: '', zipFile: 'intl-co-plsv-infr-dev.zip'
           sh 'cd ..'
           sh 'pwd'
           sh 'ls'
           sh 'zip -r co-plsv-front-infr.zip . -x co-plsv-front-infr/jenkins/dev_Jenkinsfile co-plsv-front-infr/jenkins/nonprod_Jenkinsfile co-plsv-front-infr/.serverless co-plsv-front-infr/.git/**'
           sh 'pwd'
           sh 'ls'
			  def artifacts = ['co-plsv-front-infr.zip']		
		     artifactoryUploadFiles files:artifacts,version:ARTIFACT_VERSION,packageType:'npm',appName:'co-plsv-infr'              
   }
   stage('Artifactory Promoted to Prod') {
				promoteToProd(
					email:'carlos.unate@Libertycolombia.com',
					promoteArtifact: true,
					appName:'co-plsv-infr',
					packageType:'npm',
					version: ARTIFACT_VERSION,
					singleJenkinsfilePattern: true
				){}
		}
}